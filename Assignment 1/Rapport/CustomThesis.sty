\NeedsTeXFormat{LaTeX2e}
\ProvidesPackage{CustomThesis}[24/09/25 A Thesis preamble for Aarhus University]

% I should still evaluate which packages are really necesarry/which could be commented out
% I should also evaluate the fonts used for the default style a bit more
% It would be cool to fully automate the front page, so that everthing is filled out from the 
% main file using metadata, like what i have done now for title etc.

% --- Language and page geometry ---
\usepackage[english]{babel}
% \usepackage[a4paper, total={6.5in, 9in}]{geometry}

% --- Custom commands and helpers ---
\usepackage{CustomCommands} % Your own macros and redefinitions
\usepackage{adjustbox}      % Adjust size/position of content (esp. tables/figures)
\usepackage{tabularx}       % Tables with automatically stretched columns
\usepackage{booktabs}       % Professional-looking horizontal rules in tables

% --- Bibliography / references ---
\usepackage[sorting=none]{biblatex} % Modern bibliography system
\patchcmd{\thebibliography}{\section*{\refname}}{}{}{} % Remove default "References" header
\usepackage{csquotes}       % Context-sensitive quotation marks (needed by biblatex)
\renewcommand{\UrlFont}{\small\ttfamily}
\DeclareBibliographyDriver{datasheet}{%
  \printnames{author}%
  \newunit\newblock
  \printfield{title}%
  \newunit\newblock
  \printfield{note}%
}

% --- Figures and floats ---
\usepackage{subcaption} % Subfigures with individual captions
\usepackage{float}      % More control over float placement
\usepackage{graphicx}   % Include images (pdf, png, jpg, etc.)
\usepackage{wrapfig}    % Text wrapping around figures
\usepackage{svg}        % Include SVG images (converted via Inkscape)
\usepackage{eso-pic}    % Add background material (for title page, watermark, etc.)

% --- Code listings ---
% Packages:
\usepackage{minted} % Code highlighting via Pygments (requires -shell-escape)
\usepackage{listings}
\usepackage{chngcntr}
\usepackage{fancyvrb}

% Color palette
\definecolor{CodeBackground}{RGB}{248, 248, 248} % Dark background
\definecolor{CodeText}{RGB}{30,30,30}       % Default text
\definecolor{CodeKeyword}{RGB}{86,156,214}    % Blue
\definecolor{CodeComment}{RGB}{106,153,85}    % Green for comments
\definecolor{CodeString}{RGB}{206,145,120}     % Orange/red for strings
\definecolor{CodeFunction}{RGB}{220,220,170}   % Yellow for function names
\definecolor{CodeLineNumber}{RGB}{140,140,140}   % Dark gray for line numbers

% Minted setup:
% % Set default minted style:
% \usemintedstyle{default} % Decent
% % \usemintedstyle{friendly} % Decent
% % \usemintedstyle{emacs} % Decent
% % \usemintedstyle{perldoc} % Decent
% % \usemintedstyle{vs} % Eh
% % \usemintedstyle{manni} % Eh
% % \usemintedstyle{borland} % Eh
% % \usemintedstyle{trac} % Eh
% % \usemintedstyle{bw} % Eh

% % Custom settings:
% \setminted{
%   fontsize=\small, 
%   linenos, 
%   bgcolor=CodeBackground,
%   numbersep=5pt,
%   breaklines=true,
%   % frame=single,
%   frame=lines,
%   framesep=1.5mm,
%   framerule=0.7pt,
%   rulecolor=\color{CodeText},
% }
% \renewcommand{\theFancyVerbLine}{\color{CodeLineNumber}\small\ttfamily{\arabic{FancyVerbLine}}} % Line number style

% % Create new "figure" type called listing
% \newfloat{listing}{htbp}{lop}
% \floatname{listing}{Listing}
% \counterwithin{listing}{section}

% % CodeBlock wrapper:
% \newenvironment{codeblock}[3]{%
%   \def\codeCaption{#2}%
%   \def\codeLabel{#3}%

%   \VerbatimEnvironment%
%   \begin{listing}[ht]%
%   \begin{minted}{#1}%
% }{%
%   \end{minted}%
%   \caption{\codeCaption}%
%   \label{\codeLabel}%
%   \end{listing}%
% }

% Listings setup:
% General settings
\lstset{
    basicstyle=\ttfamily\small\color{CodeText},   % Small monospace font
    keywordstyle=\color{CodeKeyword}\bfseries,
    commentstyle=\color{CodeComment}\itshape,
    stringstyle=\color{CodeString},
    identifierstyle=\color{CodeText},
    moredelim=[is][\color{CodeFunction}]{@}{@}, % Use @func@ to highlight function calls
    numbers=left,                 % Line numbers on the left
    numberstyle=\color{CodeLineNumber}\small\ttfamily, % Line number style
    numbersep=5pt,                % Space between numbers and code
    stepnumber=1,
    backgroundcolor=\color{CodeBackground}, % Default background
    breaklines=true,
    frame=single,
    rulecolor=\color{black},
    showstringspaces=false,
    tabsize=4,
    captionpos=b,
}

% CodeBlock wrapper:
\lstnewenvironment{codeblock}[3]{\lstset{language=#1, caption={#2}, label={#3}}}{}

% --- Math support ---
\usepackage{mathtools} % Extensions to amsmath
\usepackage{amsmath}   % AMS math (equations, matrices, align, etc.)
\usepackage{nicematrix} % Nicely formatted matrices with rules/lines

% --- Tables ---
\usepackage{makecell}  % Multi-line and formatted table cells
\usepackage{multirow}  % Multi-row cells
\usepackage{array}     % Extra column formatting options
\usepackage{colortbl}  % Color rows/columns/cells
\renewcommand{\arraystretch}{1.5} % Increase row spacing

% --- Text formatting ---
\usepackage{ragged2e}  % Better ragged alignment
\usepackage{enumitem}  % Customizable lists
\usepackage{changepage} % Environment for indented/narrow text blocks

% --- Units ---
\usepackage{siunitx} % SI units and number formatting
\sisetup{
    output-decimal-marker = {,},
    group-separator = {.},
    per-mode = symbol
}

% --- Microtypography ---
% Better text line breaking
% \usepackage[
%     activate={true,nocompatibility},
%     final,
%     tracking=true,
%     factor=1100,
%     stretch=10,
%     shrink=10
% ]{microtype}
% \SetTracking{encoding={*}, shape=sc}{40}

\endinput